# ``DIGIPIN``

> **Note:** This library is fully compliant with the official India Post DIGIPIN specification.

A Swift library for generating and handling India Post's DIGIPIN codes - a geographic coordinate encoding system.

## Overview

DIGIPIN (Digital Postal Index Number) is India Post's innovative solution for encoding geographic coordinates into easily readable and communicable codes. This library provides a Swift implementation for generating and decoding DIGIPIN codes, fully compliant with the official India Post specification.

A DIGIPIN code is a unique 10-character alphanumeric code (formatted as XXX-XXX-XXXX) that represents a specific geographic location within India's territory. The system divides the country's geographic area into a hierarchical grid system, providing precise location information.

## Features

- Generate DIGIPIN codes from geographic coordinates (latitude/longitude)
- Convert DIGIPIN codes back to geographic coordinates
- Validation of coordinates within India's territorial bounds
- Error handling for invalid inputs and out-of-bounds coordinates

## Topics

### Essentials

- ``DIGIPIN/generateDIGIPIN(for:)``
- ``DIGIPIN/coordinate(from:)``
- ``Coordinate``

### Error Handling

- ``DIGIPINError``

## Usage

### Generating a DIGIPIN Code

```swift
let digipin = DIGIPIN()
let coordinate = Coordinate(latitude: 28.6139, longitude: 77.2090)

do {
    let code = try digipin.generateDIGIPIN(for: coordinate)
    print(code) // Outputs a formatted DIGIPIN code
} catch {
    print("Error generating DIGIPIN: \(error)")
}
```

### Converting DIGIPIN to Coordinates

```swift
let digipin = DIGIPIN()

do {
    let coordinate = try digipin.coordinate(from: "39J-49L-L8T4")
    print("Latitude: \(coordinate.latitude), Longitude: \(coordinate.longitude)")
} catch {
    print("Error converting DIGIPIN: \(error)")
}
```

## Geographic Coverage

The DIGIPIN system covers the following geographic bounds:
Latitude: 2.5째N to 38.5째N
Longitude: 63.5째E to 99.5째E

This range encompasses the entire territory of India and includes sufficient buffer zones.

## Implementation Details

The DIGIPIN system uses a hierarchical grid system with a single 4x4 grid for all levels:

```
[
  ["F", "C", "9", "8"],
  ["J", "3", "2", "7"],
  ["K", "4", "5", "6"],
  ["L", "M", "P", "T"]
]
```

At each level, the grid is subdivided, and the code is generated by determining the cell for the given latitude and longitude. The row index is calculated using a reversed logic (`row = 3 - ...`) to match the official specification. The same grid is used for all 10 levels of the code.

For more details, see the [Official DIGIPIN Technical Documentation](https://www.indiapost.gov.in/VAS/DOP_PDFFiles/DIGIPIN%20Technical%20document.pdf).

## Command-Line Interface (CLI)

The DIGIPIN package includes a production-grade CLI tool for encoding, decoding, and distance calculation with DIGIPIN codes.

### Installation

After building the package, the CLI binary is available as `digipin-cli` in `.build/debug` or `.build/release`.

### Usage

```
# Encode latitude and longitude to a DIGIPIN code
$ digipin encode <latitude> <longitude>

# Decode a DIGIPIN code to latitude and longitude
$ digipin decode <DIGIPIN>

# Compute the distance (in km) between two DIGIPIN codes
$ digipin distance <DIGIPIN1> <DIGIPIN2>
```

### Examples

```
$ digipin encode 12.9716 77.5946
4P3-JK8-52C9

$ digipin decode 4P3-JK8-52C9
12.971601, 77.594584

$ digipin distance 4P3-JK8-52C9 39J-49L-L8T4
1740.12 km
```

### Available Commands

- `encode <latitude> <longitude>`: Encode latitude and longitude to a DIGIPIN code.
- `decode <DIGIPIN>`: Decode a DIGIPIN code to latitude and longitude.
- `distance <DIGIPIN1> <DIGIPIN2>`: Compute the great-circle distance (in kilometers) between two DIGIPIN codes.

The CLI is built using Swift ArgumentParser and is fully Swift 6 and concurrency compliant.

## Changelog

### Version 2.2.0 (2025-07-02)
- Added
    - Bulk encode (`bulkEncode`) and bulk decode (`bulkDecode`) API to the DIGIPIN library for efficient batch operations.
    - Unit tests for bulk encode and decode, covering valid, invalid, and mixed input cases.
- Changed
    - Improved error handling for batch operations in the DIGIPIN library.
    ---

### Version 2.1.0 (2025-07-01)
- Added
    - CLI tool (`digipin`) for encoding, decoding, and distance calculation.
    - Public distance calculation API to the DIGIPIN library.
    - CLI integration tests for encode, decode, and distance commands.
    - Swift 6 concurrency compliance for CLI and library.
- Changed
    - Improved documentation and usage examples for CLI and distance features.
    - Updated test targets and structure for CLI integration.
- Fixed
    - Fixed SwiftPM test discovery for CLI tests.
    - Fixed concurrency warnings in CLI code for Swift 6.
    ---

### Version 2.0.0 (2025-06-30)
- Breaking Change
    - The DIGIPIN implementation is now **fully compliant** with the official India Post specification ([Technical Document](https://www.indiapost.gov.in/VAS/DOP_PDFFiles/DIGIPIN%20Technical%20document.pdf)).
    - Previous versions (including `1.0.0`) may generate incompatible codes. All users should upgrade to this version for official compatibility.
- Added
    - Official grid, bounds, and encoding/decoding logic as per India Post.
    - Updated documentation, usage examples, and developer guide.
    - Additional unit tests for official and edge-case examples.
- Changed
    - Refactored code for clarity, immutability, and best Swift practices.
    - Improved error messages and type safety.
- Fixed
    - Corrected grid, bounds, and logic to match the official DIGIPIN system.
    ---

### Version 1.0.0 (2025-02-17)
- Added
    - Initial release of the DIGIPIN Swift library.
    - Encode latitude/longitude to DIGIPIN and decode DIGIPIN to coordinates.
    - Input validation and error handling.
    - Documentation and usage examples.
    - Unit tests for basic functionality.
- Note
    - This version was **not fully compliant** with the official India Post DIGIPIN specification. Users should upgrade to `2.0.0` or later for official compatibility.
    ---
